<!DOCTYPE html>
<html lang="pt-BR">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script src="../js/htmx.min.js"></script>
        <script src="../js/client-side-templates.min.js"></script>
        <script src="../js/mustache.min.js"></script>

        <link rel="manifest" href="../js/manifest.json">
        <link rel="icon" href="../icons/favicon.png" type="image/x-icon">
        <link rel="stylesheet" href="../css/style.css">
        <link rel="stylesheet" href="../css/dialog.css">
        <link rel="stylesheet" href="../css/report.css">

        <title>NCC - Acompanhamento de Frequência - Quadro Geral</title>
    </head>

    <body>
        <div class="container report">
            <div class="card">
                <div class="header">
                    <img class="back" src="../images/arrow-back.png" onclick="(window.location='/p/pages/index.html')"
                        alt="back">
                    <h1 class="report"><span>Acompanhamento de &nbsp;</span>Frequência dos NCCs - Quadro Geral</h1>
                </div>

                <div id="loading">
                    <img class="htmx-indicator" src="../icons/spinner.svg" alt="loadding">
                </div>

                <div hx-ext="client-side-templates">

                    <div id="result" class="report">
                        <!-- Os dados vão ser exibidos aqui. -->
                    </div>

                    <template id="presences-matrix">

                        <div class="summary report">
                            {{#summary}}
                                <div class="dialog">
                                    <h2> Participantes Cadastrados</h2>
                                    <h2 class="numbers">{{ totalPersons }}</h2>
                                </div>
                                <div class="dialog">
                                    <h2> Semanas Ativas</h2>
                                    <h2 class="numbers">{{ activeWeeksTotal }}</h2>
                                </div>
                                <div class="dialog">
                                    <h2> Participações no Período</h2>
                                    <h2 class="numbers">{{ totalPresent }}</h2>
                                </div>
                                <div class="dialog">
                                    <h2> Ausências no Período</h2>
                                    <h2 class="numbers">{{ totalAbsent }}</h2>
                                </div>
                                <div class="dialog">
                                    <h2> Fequência Média</h2>
                                    <h2 class="numbers">{{ percentPresent }}%</h2>
                                </div>
                            {{/summary}}
                        </div>

                        <div class="report-table">
                            <table class="table-fixed">
                                <thead>
                                    <tr>
                                        <th class="report">Nome</th>
                                        <!-- {{#heads}} -->
                                        <th id="S{{.}}" class="report">{{.}}</th>
                                        <!-- {{/heads}} -->
                                    </tr>
                                </thead>

                                <tbody>

                                    <!-- {{#presences}} -->
                                    <tr>
                                        <td class="person-name report" data-person-id="{{personId}}"
                                            onclick="showPersonDialog(event)">{{name}}</td>

                                        <!-- {{#weekData}} -->
                                        <td class="report">
                                            {{#present}}
                                                <button class="presence report present" data-person-id="{{personId}}"
                                                    data-week="{{week}}">✓</button>
                                            {{/present}}
                                            {{^present}}
                                                <button class="presence report absent" data-person-id="{{ personId}}"
                                                    data-week="{{ week }}">&nbsp;</button>
                                            {{/present}}
                                        </td>
                                        <!-- {{/weekData}} -->

                                    </tr>
                                    <!-- {{/presences}} -->

                                </tbody>

                                <tfoot>
                                    <tr class="total-cell">
                                        <td class="total-cell report">Total</td>

                                        <!-- {{#weekTotals}} -->
                                        <td class=" report">
                                            <div class="total-present">✔ {{present}}</div>
                                            <div><small>{{percent}}%</small></div>
                                        </td>
                                        <!-- {{/weekTotals}} -->

                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </template>
                </div>
            </div>

        </div>

        <dialog id="person-details" class="dialog">
            <!-- Detalhes do participante aqui -->
        </dialog>

        <template id="details-template">
            <article class="article">
                <header>
                    <span onclick="closePersonDialog()">×</span>
                </header>

                <div class="dlg-body">
                    <div class="person-header">
                        {{#person}}
                            <div class="person-avatar">{{initials}}</div>
                            <div class="person-info">
                                <h3>{{name}}</h3>
                                <a href="https://wa.me/{{phone}}" target="_blank" rel="nofollow noopener noreferrer">
                                    <span>Fone: {{formatedPhone}}</span>
                                </a>
                            </div>
                        {{/person}}
                    </div>
                    <div class="details">
                        <span class="detail-label">Frequência:</span>
                        {{#moreThanOne}}
                            <span class="detail-value">{{qtdWeeks}} participações nas últimas semanas</span>
                        {{/moreThanOne}}

                        {{^moreThanOne}}
                            <span class="detail-value">{{qtdWeeks}} participação nas últimas semanas</span>
                        {{/moreThanOne}}
                    </div>
                    <div class="presence-history">
                        <div class="detail-label">Histórico por semana:</div>
                        <div class="presence-list">
                            {{#presences}}
                                <span class="week-badge {{#present}}present{{/present}}{{^present}}absent{{/present}}">
                                    {{week}}
                                    {{#present}}✓{{/present}}{{^present}}✗{{/present}}
                                </span>
                            {{/presences}}
                        </div>
                    </div>
                </div>
            </article>
        </template>

        <div id="toast">
            <span id="message">
                <!-- Mensagem de notificação -->
            </span>
        </div>

        <script src="../js/auth.js"></script>
        <script>
            // Verifica autenticação antes de executar o script principal
            if (window.auth) {
                window.auth.requireLogin();
            }
        </script>
        <script src="../js/login.js"></script>
        <script src="../js/main.js"></script>
        <script src="../js/report.js"></script>
    </body>

</html>