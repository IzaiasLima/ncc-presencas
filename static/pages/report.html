<!DOCTYPE html>
<html lang="pt-BR">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script src="../js/htmx.min.js"></script>
        <script src="../js/client-side-templates.min.js"></script>
        <script src="../js/mustache.min.js"></script>

        <link rel="manifest" href="../js/manifest.json">
        <link rel="icon" href="../icons/favicon.png" type="image/x-icon">
        <link rel="stylesheet" href="../css/style.css">
        <link rel="stylesheet" href="../css/dialog.css">
        <link rel="stylesheet" href="../css/report.css">

        <title>NCC - Acompanhamento de Frequência - Quadro Geral</title>
    </head>

    <body>
        <div class="container full">
            <div class="card">
                <div class="header">
                    <img class="back" src="../images/arrow-back.png" onclick="(window.location='/p/pages/index.html')"
                        alt="back">
                    <h1 class="full">Acompanhamento de Frequência dos NCCs - Quadro Geral</h1>
                </div>

                <div id="loading">
                    <img class="htmx-indicator" src="../icons/spinner.svg" alt="loadding">
                </div>

                <div hx-ext="client-side-templates">

                    <div id="result" class="full">
                        <!-- Os dados vão ser exibidos aqui. -->
                    </div>

                    <template id="presences-matrix">
                        <table class="table-fixed">
                            <thead>
                                <tr>
                                    <th class="mini">Nome</th>
                                    <!-- {{#heads}} -->
                                    <th id="S{{.}}" class="mini">{{.}}</th>
                                    <!-- {{/heads}} -->
                                </tr>
                            </thead>

                            <tbody>

                                <!-- {{#presences}} -->
                                <tr>
                                    <td class="person-name mini" data-person-id="{{personId}}"
                                        onclick="showPersonDialog(event)">{{name}}</td>

                                    <!-- {{#weekData}} -->
                                    <td class="mini">
                                        {{#present}}
                                            <button
                                                class="presence mini present {{#isCurrent}}current-week{{/isCurrent}}"
                                                data-person-id="{{personId}}" data-week="{{week}}"
                                                onclick="updatePresence(event)">✓</button>
                                        {{/present}}
                                        {{^present}}
                                            <button
                                                class="presence mini absent {{#isCurrent}}current-week{{/isCurrent}}"
                                                data-person-id="{{ personId}}" data-week="{{ week }}"
                                                onclick="updatePresence(event)">&nbsp;</button>
                                        {{/present}}
                                    </td>
                                    <!-- {{/weekData}} -->

                                </tr>
                                <!-- {{/presences}} -->

                            </tbody>

                            <tfoot>
                                <tr class="total-cell">
                                    <td class="total-cell mini">Total</td>

                                    <!-- {{#weekTotals}} -->
                                    <td class=" mini">
                                        <div class="total-present">✔ {{present}}</div>
                                        <div><small>{{percent}}%</small></div>
                                    </td>
                                    <!-- {{/weekTotals}} -->

                                </tr>
                            </tfoot>
                        </table>
                    </template>
                </div>
            </div>

            <!-- <div class="statistics">
                <h2 id="h2-title">Resumo geral por NCC:</h2>
            </div> -->
        </div>

        <dialog id="person-details" class="dialog">
            <!-- Detalhes do participante aqui -->
        </dialog>

        <template id="details-template">
            <article class="article">
                <header>
                    <span onclick="closePersonDialog()">×</span>
                </header>

                <div class="dlg-body">
                    <div class="person-header">
                        {{#person}}
                            <div class="person-avatar">{{initials}}</div>
                            <div class="person-info">
                                <h3>{{name}}</h3>
                                <a href="https://wa.me/{{phone}}" target="_blank" rel="nofollow noopener noreferrer">
                                    <span>Fone: {{formatedPhone}}</span>
                                </a>
                            </div>
                        {{/person}}
                    </div>
                    <div class="details">
                        <span class="detail-label">Frequência:</span>
                        {{#moreThanOne}}
                            <span class="detail-value">{{qtdWeeks}} participações nas últimas semanas</span>
                        {{/moreThanOne}}

                        {{^moreThanOne}}
                            <span class="detail-value">{{qtdWeeks}} participação nas últimas semanas</span>
                        {{/moreThanOne}}
                    </div>
                    <div class="presence-history">
                        <div class="detail-label">Histórico por semana:</div>
                        <div class="presence-list">
                            {{#presences}}
                                <span class="week-badge {{#present}}present{{/present}}{{^present}}absent{{/present}}">
                                    {{week}}
                                    {{#present}}✓{{/present}}{{^present}}✗{{/present}}
                                </span>
                            {{/presences}}
                        </div>
                    </div>
                </div>
            </article>
        </template>

        <div id="toast">
            <span id="message">
                <!-- Mensagem de notificação -->
            </span>
        </div>

        <script src="../js/auth.js"></script>
        <script>
            // Verifica autenticação antes de executar o script principal
            if (window.auth) {
                window.auth.requireLogin();
            }
        </script>
        <script src="../js/login.js"></script>
        <script src="../js/main.js"></script>
        <script src="../js/report.js"></script>
    </body>

</html>